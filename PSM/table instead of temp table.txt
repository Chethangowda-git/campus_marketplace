-- Design Note: Why Escrow_Verification is a Regular Table and Not a Temp Table

-- For the escrow verification flow, we initially considered using a global temporary table to store the one-time verification codes (similar to OTPs used in apps like Uber). However, we decided to implement Escrow_Verification as a small permanent table instead of a temp table, for the following reasons:
-- 	1.	Business process is longer than a single session
-- The escrow verification code is generated at checkout time, but it is used later when the buyer and seller physically meet (which could be minutes, hours, or even days after). Temporary tables in SQL Server (#Local or ##Global) are scoped to sessions and connections, and are automatically dropped when the session ends. This makes them unsuitable for data that must survive across multiple, independent user sessions.
-- 	2.	Global temp tables are shared and cannot be safely dropped per transaction
-- A global temp table (##EscrowVerification) is shared across all sessions. Dropping it to “clean up after one transaction” would remove data for every other ongoing transaction using the same temp table. In a concurrent marketplace scenario, this would be unsafe and could break other users’ verifications.
-- 	3.	Per-row cleanup is safer and still behaves like a temp store
-- By using a regular table Escrow_Verification keyed by OrderID, we can treat it as a temporary store at the row level:
-- 	•	When the verification succeeds and payment is completed, the corresponding row is deleted.
-- 	•	This gives the same “ephemeral” behavior as a temp store, but with proper isolation per order and without impacting other users.
-- 	4.	Temp tables are used where session-scoped lifetime makes sense
-- Temporary tables are better suited for short-lived intermediate calculations inside stored procedures (e.g., pre-aggregations, complex joins for reporting) where the data only needs to exist during a single session. In contrast, the escrow verification code must exist between separate user interactions and sessions, so a permanent table with controlled deletes is the correct design.

-- Because of these reasons, Escrow_Verification is implemented as a normal table with:
-- 	•	One row per order (PRIMARY KEY (OrderID)),
-- 	•	A globally unique verification code (UNIQUE (Verification_Code)),
-- 	•	And row-level deletion once the transaction is completed, effectively giving us a safe and controlled “temp-like” behavior.